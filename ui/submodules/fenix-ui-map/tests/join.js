
requirejs(['../src/paths'], function (paths) {
    'use strict';

    paths.baseUrl = '../';

    require.config(paths);

    require([
        'jquery','jquery','underscore','bootstrap','handlebars',
        'fenix-map',
        'fenix-map-config',
        'domready!'
    ], function($,jQuery,_,bts,Handlebars,
                FenixMap, FenixMapConf) {

        _.extend(FenixMapConf, {
            BASEURL: '../dist',
            BASEURL_LANG: '../dist/i18n/'
        });

        var m = new FM.Map('map1', {
            plugins: {
            	disclaimerfao: true,
                geosearch: true,
                mouseposition: false,
                controlloading: true
            },
            guiController: {
                overlay: true,
                baselayer: true,
                wmsLoader: true
            },
            url: {
                MAP_SERVICE_SHADED: 'http://fenix.fao.org/test/geo/fenix/mapclassify/join/',
                DEFAULT_WMS_SERVER: 'http://fenix.fao.org/geoserver',
                MAP_SERVICE_GFI_JOIN: 'http://fenix.fao.org/test/geo/fenix/mapclassify/request/',
                MAP_SERVICE_GFI_STANDARD: 'http://fenix.fao.org/test/geo/fenix/mapclassify/request/'
            }
        });
        
        m.createMap(0, 0, 1);

        var rawData = [["2","Afghanistan","512094.0","tonnes"],["4","Algeria","320.0","tonnes"],["7","Angola","37608.0","tonnes"],["9","Argentina","1563450.0","tonnes"],["10","Australia","1161115.0","tonnes"],["16","Bangladesh","5.15E7","tonnes"],["18","Bhutan","78730.0","tonnes"],["19","Bolivia (Plurinational State of)","426050.6009","tonnes"],["21","Brazil","1.1782549E7","tonnes"],["23","Belize","20505.0","tonnes"],["25","Solomon Islands","4200.0","tonnes"],["26","Brunei Darussalam","1850.0","tonnes"],["27","Bulgaria","54900.0","tonnes"],["28","Myanmar","2.8767E7","tonnes"],["29","Burundi","41454.0","tonnes"],["32","Cameroon","194094.0","tonnes"],["37","Central African Republic","42500.0","tonnes"],["38","Sri Lanka","4620730.0","tonnes"],["39","Chad","330000.0","tonnes"],["40","Chile","130307.0","tonnes"],["41","China, mainland","2.036122E8","tonnes"],["44","Colombia","2048938.0","tonnes"],["45","Comoros","29000.0","tonnes"],["46","Congo","1700.0","tonnes"],["48","Costa Rica","224570.0","tonnes"],["49","Cuba","672600.0","tonnes"],["52","Azerbaijan","4833.0","tonnes"],["53","Benin","206943.0","tonnes"],["56","Dominican Republic","824000.0","tonnes"],["58","Ecuador","1516045.0","tonnes"],["59","Egypt","6100000.0","tonnes"],["60","El Salvador","36254.0","tonnes"],["66","Fiji","5000.0","tonnes"],["68","France","82000.0","tonnes"],["69","French Guiana","2020.0","tonnes"],["74","Gabon","1700.0","tonnes"],["75","Gambia","69704.0","tonnes"],["81","Ghana","569524.0","tonnes"],["84","Greece","227000.0","tonnes"],["89","Guatemala","32051.0","tonnes"],["90","Guinea","2053000.0","tonnes"],["91","Guyana","823800.0","tonnes"],["93","Haiti","169299.66","tonnes"],["95","Honduras","49656.0","tonnes"],["97","Hungary","9800.0","tonnes"],["100","India","1.592E8","tonnes"],["101","Indonesia","7.1279709E7","tonnes"],["102","Iran (Islamic Republic of)","2900000.0","tonnes"],["103","Iraq","451849.0","tonnes"],["106","Italy","1339000.0","tonnes"],["107","Côte d\u0027Ivoire","1934154.0","tonnes"],["108","Kazakhstan","344300.0","tonnes"],["109","Jamaica","31.0","tonnes"],["110","Japan","1.0758E7","tonnes"],["113","Kyrgyzstan","27220.0","tonnes"],["114","Kenya","146696.0","tonnes"],["115","Cambodia","9390000.0","tonnes"],["116","Democratic People\u0027s Republic of Korea","2901000.0","tonnes"],["117","Republic of Korea","5631689.0","tonnes"],["120","Lao People\u0027s Democratic Republic","3415000.0","tonnes"],["123","Liberia","238000.0","tonnes"],["129","Madagascar","3610626.0","tonnes"],["130","Malawi","125156.0","tonnes"],["131","Malaysia","2626881.0","tonnes"],["133","Mali","2211920.0","tonnes"],["136","Mauritania","192000.0","tonnes"],["137","Mauritius","646.0","tonnes"],["138","Mexico","179776.0","tonnes"],["143","Morocco","37716.0","tonnes"],["144","Mozambique","351000.0","tonnes"],["145","Micronesia (Federated States of)","165.0","tonnes"],["149","Nepal","4504503.0","tonnes"],["154","The former Yugoslav Republic of Macedonia","27921.0","tonnes"],["157","Nicaragua","377470.0699","tonnes"],["158","Niger","40000.0","tonnes"],["159","Nigeria","4700000.0","tonnes"],["165","Pakistan","6798100.0","tonnes"],["166","Panama","287395.0","tonnes"],["168","Papua New Guinea","1300.0","tonnes"],["169","Paraguay","617397.0","tonnes"],["170","Peru","3050934.028","tonnes"],["171","Philippines","1.8439406E7","tonnes"],["174","Portugal","168300.0","tonnes"],["175","Guinea-Bissau","209717.0","tonnes"],["176","Timor-Leste","87000.0","tonnes"],["181","Zimbabwe","700.0","tonnes"],["182","Réunion","260.0","tonnes"],["183","Romania","54646.0","tonnes"],["184","Rwanda","93746.0","tonnes"],["185","Russian Federation","934943.0","tonnes"],["195","Senegal","423482.0","tonnes"],["197","Sierra Leone","1255559.0","tonnes"],["201","Somalia","1970.0","tonnes"],["202","South Africa","3000.0","tonnes"],["203","Spain","851500.0","tonnes"],["206","Sudan (former)","25000.0","tonnes"],["207","Suriname","262029.0","tonnes"],["208","Tajikistan","98000.0","tonnes"],["209","Swaziland","105.0","tonnes"],["213","Turkmenistan","130000.0","tonnes"],["214","China, Taiwan Province of","1594320.0","tonnes"],["215","United Republic of Tanzania","2194750.0","tonnes"],["216","Thailand","3.60626E7","tonnes"],["217","Togo","164998.0","tonnes"],["220","Trinidad and Tobago","2859.0","tonnes"],["223","Turkey","900000.0","tonnes"],["226","Uganda","214000.0","tonnes"],["230","Ukraine","145050.0","tonnes"],["231","United States of America","8613094.0","tonnes"],["233","Burkina Faso","305382.0","tonnes"],["234","Uruguay","1359000.0","tonnes"],["235","Uzbekistan","340219.0","tonnes"],["236","Venezuela (Bolivarian Republic of)","1005000.01","tonnes"],["237","Viet Nam","4.403929126E7","tonnes"],["238","Ethiopia","184210.0","tonnes"],["250","Democratic Republic of the Congo","355000.0","tonnes"],["251","Zambia","44747.0","tonnes"],["351","China","2.0520652E8","tonnes"]]
        var data = []
        rawData.forEach(function(d){
            var v = {};
            v[d[0]] = parseFloat(d[2])
            data.push(v)
        });
        var joincolumnlabel = 'areanamee';
        var joincolumn = 'faost_code';
        var mu = 'Tonnes';

        var layer = new FM.layer({
            layers: 'fenix:gaul0_faostat_3857',
            layertitle: 'Rice Paddy Production 2013',
            opacity: '0.7',
            joincolumn: joincolumn,
            joincolumnlabel: joincolumnlabel,
            joindata: data,
            mu: mu,
            measurementunit: mu,
            layertype: 'JOIN',
            jointype: 'shaded',
            openlegend: true,
            defaultgfi: true,
            colorramp: 'Reds',
            lang: 'en',
            customgfi: {
                content: {
                    en: "<div class='fm-popup'>{{" + joincolumnlabel + "}} <div class='fm-popup-join-content'>{{{" + joincolumn + "}}}</div></div>"
                },
                showpopup: true
            }
        });
        m.addLayer(layer);

        m.addLayer(new FM.layer({
            layers: 'fenix:gaul0_line_3857',
            layertitle: 'Country Boundaries',
            urlWMS: 'http://fenixapps.fao.org/geoserver',
            opacity: '0.9',
            lang: 'en'
        }));

        // map2
        var m2 = new FM.Map('map', {
            plugins: {
                geosearch: true,
                mouseposition: false,
                controlloading : true
            },
            guiController: {
                overlay: true,
                baselayer: true,
                wmsLoader: true
            },
            url: {
                MAP_SERVICE_SHADED: 'http://fenix.fao.org/test/geo/fenix/mapclassify/join/',
                DEFAULT_WMS_SERVER: 'http://fenix.fao.org/geoserver',
                MAP_SERVICE_GFI_JOIN: 'http://fenix.fao.org/test/geo/fenix/mapclassify/request/',
                MAP_SERVICE_GFI_STANDARD: 'http://fenix.fao.org/test/geo/fenix/mapclassify/request/'
            }
        });
        m2.createMap();
        m2.zoomTo("country", "iso3", ["IND", "THA", "IDN", "JPN"]);


        var joincolumnlabel = 'adm1_name';
        var joincolumn =  'adm1_code';
        var mu =  '&#37;';
        var data = [{2851:0.3890407849913058}, {1484:0.0}, {1485:0.14587320634043877}, {3326:1.1779763193234154}, {2852:0.9302563071250916}, {898:0.16676137293681098}, {65290:0.006531819235533476}, {70072:0.03314925647519399}, {1487:0.32998849673955527}, {2126:0.6343060518149286}, {3329:0.32832962013180217}, {3328:0.053023914221483164}, {3330:0.4800397265288565}, {3331:0.9728243827819825}, {41772:0.2582967267911984}, {41773:0.31295659073761534}, {1513:0.27569127714054453}, {73609:0.008915747770653019}, {2853:0.17234909627586603}, {791:0.2410633740265195}, {73610:0.46284970617853105}, {3327:0.13429037960512297}, {575:1.161935133429674}, {792:0.14192057833573674}, {899:0.008880215552881982}, {1514:0.05532403657240654}, {3332:0.5400158800184727}, {70073:0.365643781835995}, {3333:0.1268453442802032}, {3334:0.1365749561227858}, {3335:0.15187414127091567}, {3336:0.10674026335843585}, {2854:0.4189308677386079}, {3339:0.33006528827051324}, {73933:0.7452339380979538}, {3338:0.04834749282484776}, {2855:0.32820274386751025}, {2856:0.9197667360305786}, {2857:0.13521629769583138}, {70074:0.1530473679304123}, {2858:0.031712847306056224}, {70075:0.22873023134937542}, {2859:0.036804911760425954}, {2860:0.14849361156772697}, {2125:0.011629518357092838}, {576:0.5569711034572625}, {2861:0.0732613573782146}, {900:0.0971327385780346}, {2862:0.030238241632469}, {70076:0.16983502606550852}, {1515:0.34948827732693066}, {73934:0.020257028837134983}, {73935:0.013474131230678824}, {70077:0.0}, {3340:0.3857187256217003}, {1489:0.04925856385186004}, {577:0.8754057094094253}, {73936:0.016538141083214688}, {1516:0.09636071813292801}, {3342:0.06049511727604379}, {3343:1.33341820343681}, {901:0.11581291568427332}, {902:0.0004992336282731202}, {3344:0.03101025382638909}, {1490:0.2755943821477039}, {73611:0.029260089919890885}, {903:0.14669894695784416}, {904:0.0990626767182251}, {905:0.04222356139200902}, {1491:0.02656723947388442}, {3345:0.020108804374103784}, {3350:0.31277590841054914}, {906:0.0989795786888516}, {3351:0.8666307270526886}, {3346:1.0427417516708375}, {3347:0.7822257354855537}, {1492:0.24822606257096672}, {3348:0.49319594022300506}, {3349:0.18626736754297532}, {73937:0.6023210659623146}, {907:0.008714180792641475}, {908:0.015594295475529674}, {909:0.029954988654193142}, {1493:0.01627714609469287}, {3353:0.14165425755911404}, {3352:0.36767878180200403}, {911:0.12866606975009773}, {912:0.19492377156444193}, {3354:1.1323113441467285}, {1518:0.04118415905824783}, {73613:0.4881956050734198}, {1520:0.46475987620811604}, {1521:0.35929890881528914}, {70078:0.21686961051697531}, {913:0.23892442775968067}, {914:0.18255433899819917}, {915:0.022904845022389566}, {2127:0.01875112119478037}, {2863:0.30397417590022086}, {1522:0.03754541130922608}, {1523:0.10984840009768959}, {1524:0.01910794220046279}, {1525:0.008648766307649752}, {2864:0.2996968883164828}, {793:0.18714253723566585}, {794:0.17541333260014652}, {795:0.12429013905324499}, {796:0.08941620731544074}, {797:0.3222522829370252}, {2865:0.04852545284499813}, {798:0.24312730729579926}, {1494:0.07037464250468387}, {2129:0.02608863567761348}, {2128:0.0651305613777878}, {73614:0.011023204445853087}, {1495:0.08451294097343987}, {3355:0.1263948724915584}, {2866:0.28302914909540844}, {578:0.7303578446796335}, {3356:0.6530189891887266}, {799:0.03163717416125934}, {3357:0.024335631475384745}, {2867:0.03406929788179695}, {801:0.021665636803359225}, {73938:0.02438174507741888}, {3359:0.028158345732136048}, {2868:0.056260728107493684}, {2869:0.050864815705322794}, {1526:0.13556683192176647}, {3360:0.049071837186573014}, {73939:0.02695217244707657}, {916:0.02982109714274117}, {2870:0.07214633658086547}, {3362:1.0395785154718342}, {2871:0.29541237584569235}, {70079:0.05701595024119671}, {2872:0.010500530259029821}, {2130:0.0517632101613706}, {1498:0.04697777327712601}, {2873:0.4702300988137722}, {73615:0.0004861912145204567}, {73616:0.0013667887550780603}, {2131:0.08660236104459425}, {1500:0.07717894883809676}, {1501:0.05571263973686974}, {1502:0.050312348700672214}, {2132:0.3395594090626046}, {803:0.01153179550750124}, {2874:0.263625406101346}, {1503:0.008097420751084059}, {2875:0.36143682964823465}, {2876:0.4877506116261849}, {2877:0.16997936057547727}, {2878:0.24116287681440643}, {2879:0.43386321841445685}, {2880:0.11223487058388336}, {3364:1.0971093823512394}, {2881:0.052322151858566535}, {1512:0.059794329408512335}, {2882:0.03967615554173445}, {917:0.000785006189445478}, {3366:0.11471195376409432}, {918:0.009823343305930158}, {3367:0.8436288183761967}, {3368:0.10823526326566935}, {2883:0.07952419629898565}, {2884:0.21487887672936687}, {2885:0.7162161469459534}, {1528:0.15445903478726997}, {1529:0.040489764629624954}, {1504:0.30548632858812497}, {804:0.06372952051064436}, {805:0.08315468352520838}, {73617:0.00022755684911567804}, {73612:0.0004670152539151204}, {2886:0.6324857638941871}, {2887:0.162442954426462}, {2888:0.18831775965435163}, {2889:0.007250842355036488}, {2890:0.20111073791980744}, {2891:0.13702109004655966}, {2892:0.15093685926071235}, {2893:0.12078131172096446}, {2894:0.6914545893669128}, {2895:0.2564481815070282}, {806:0.5136359930038452}, {2897:0.06775852870813819}, {2896:0.7121704587569604}, {2898:0.016825199592858553}, {3369:0.18656927877320692}, {3370:0.15078605062195233}, {2899:0.022375370148273014}, {802:0.18895645532757044}, {807:0.015148979240038898}, {808:0.5042677387595177}, {70080:0.35427626222372055}, {1505:0.47355912606287587}, {809:0.10893728993833066}, {919:4.2362011395666025e-09}, {3371:0.07489185352205184}, {3372:0.07180664167390205}, {3374:0.2024730053996401}, {3375:0.10961074780586154}, {3376:0.1088902969204355}, {1506:0.004781437252599451}, {61362:0.8876576654210284}, {2123:0.12255886290410173}, {61363:0.927580979659403}, {2900:0.019072542898356915}, {810:0.018957634820626713}, {2901:0.1652948578718949}, {2902:0.01730291091877481}, {73618:0.019008217700625173}, {2903:0.502347964545091}, {2133:0.021226411165737705}, {2904:0.2292529372125864}, {2905:0.26544602939652073}, {2906:0.15866002440452576}, {2907:0.09346106808100428}, {2908:0.1571237031991283}, {2909:0.26251862190950376}, {2910:0.05384949760304557}, {920:0.007727107787298368}, {921:0.010763852853947008}, {41774:0.0341785818040784}, {922:0.30230834815435875}, {41775:0.027880812192658293}, {41776:0.019934605410687246}, {923:0.0007548232927208414}, {924:0.04369677855136391}, {811:0.045632172343033885}, {1507:0.01831124260397855}, {2912:1.0361843307813008}, {2911:0.4035283609991893}, {3377:1.0930433471997578}, {2913:0.08605727915548617}, {3378:0.028767662942996836}, {812:0.013847473015344251}, {2914:0.2147416089102626}, {73619:0.04780834104429494}, {73620:0.14613490191839854}, {1532:0.027795922290533782}, {1533:0.02494997464695034}, {73621:0.04103949700032225}, {1535:0.10094705325817423}, {73622:0.050217357505245704}, {1537:0.09985530844182079}, {2915:0.5493257530033588}, {2916:0.02084352040002423}, {2917:0.5004753528628498}, {813:0.5715471483767033}, {580:0.8042392396174445}, {2918:0.028377516760056922}, {814:0.598705075003884}, {1508:0.17226533517837966}, {2135:0.026484718182311153}, {3379:0.20147239472027179}, {3380:1.1230477624469333}, {3381:0.29518552468373227}, {3382:0.2539355199466028}, {3383:0.09222471446264535}, {926:0.04239048958632664}, {3384:0.7039257235386792}, {2919:0.028963041271230106}, {2920:0.03567715511927681}, {3386:1.197632944583893}, {1509:0.18099525298287228}, {3387:0.08063677765746066}, {2921:0.3521129935647228}, {2922:0.09839504547417163}, {2923:0.39029274179357226}, {2924:0.12247373049956609}, {70082:0.04583802489973377}, {70081:0.2210957063442461}, {3388:1.4444791674613953}, {3389:0.252635867231422}, {1511:0.6996634812397964}, {927:0.0002780310281249895}, {928:1.1509716183762412e-05}, {2925:0.02761636081462105}, {2136:0.6287516952595777}, {2926:0.37962546271662556}, {3390:0.06818074731261663}, {929:0.023980253905863273}, {930:0.2005439134369995}, {1651:0.051669483166188}, {1652:0.07405272191933084}, {1653:0.05269309321662322}, {1753:0.014606789165340802}, {1754:0.026022995364459633}, {1755:0.03689394513580215}, {2152:0.16690649303103175}, {1756:0.05535775806045655}, {2153:0.1717336429232091}, {1654:0.03423706899047829}, {2154:0.0643833356885311}, {1658:0.025009032913658302}, {1659:0.03406839122596596}, {1660:0.032849470793033936}, {1661:0.017169162680151194}, {1757:0.015760104111556775}, {1655:0.05316744210492624}, {1656:0.08830120390262075}, {1657:0.06984541628927249}, {1662:0.05248748282504427}, {1663:0.14692278540072343}, {1664:0.0635954615870668}, {1665:0.03652201824766284}, {1666:0.10952729539712891}, {1667:0.034187027909071514}, {1668:0.017729301737355336}, {1758:0.028201235160748992}, {1669:0.021032598823768314}, {1670:0.0771346322618998}, {1671:0.04625642480689804}, {1760:0.018081030362382434}, {1759:0.01813369169223247}, {2155:0.032729917295947424}, {1672:0.05872479467372479}, {1673:0.10560765077471969}, {1674:0.03203780797614147}, {1675:0.02955693810894017}, {1676:0.057653818957545365}, {1677:0.0283137305307069}, {1678:0.08697520952693094}, {1680:0.055225891698177695}, {1681:0.0026911467236156263}, {1679:0.041622471545775565}, {1682:0.02933682904889186}, {1761:0.01995659911398948}, {1762:0.02071105793196087}, {1683:0.126528655923903}, {1684:0.06296295376960188}, {1763:0.045563246790521046}, {1764:0.056656959288759356}, {1685:0.10443054219811326}, {1686:0.03455326209835235}, {1687:0.02083260155165062}, {1693:0.12026502032114088}, {1689:0.035302767280216626}, {1690:0.014472724861116148}, {1688:0.11037425338016714}, {1691:0.0501323611750148}, {1692:0.08787879803339424}, {74346:0.03084425503766397}, {1768:0.15326248391948896}, {1694:0.019241699392626866}, {2156:0.09909630818077073}, {1765:0.01982529132219497}, {1766:0.008872632433373768}, {74347:0.012309452875342686}, {1695:0.07017249552617696}, {1696:0.047469478671164175}, {1697:0.015622941949202315}, {67156:0.1359684140770696}, {2354:0.058372796701459104}, {1891:0.0006180931922308234}, {1892:0.1507474934934812}, {1893:0.03540128795042013}, {1895:0.004217672098258679}, {2355:0.09737767186015844}, {1896:0.0011172940980031854}, {1897:0.001064164624568225}, {1898:0.027063828648214727}, {1899:0.04571327567100525}, {1900:0.22212261855602264}, {2357:0.18087887767337493}, {67165:0.26740940976287086}, {2356:0.2582273435863582}, {67166:0.09390094214203683}, {67167:0.09992622170830145}, {67159:0.10496154656927836}, {2361:0.18483402617275715}, {2363:0.0697634727588262}, {2364:0.11298803949769395}, {2362:0.2793419354573916}, {67161:0.05662142677877949}, {2368:0.06235153430966827}, {67162:0.16573507782931512}, {67160:0.07658992713162055}, {1901:0.047357688850796144}, {1902:0.002649291342592887}, {1903:0.032292517332179055}, {1904:0.010077779986842096}, {1054:0.017418899090085743}, {2431:0.18821893403163323}, {2432:0.16546125370418516}, {2433:0.1897995300913373}, {2434:0.10008186530903913}, {2435:0.16987843407152953}, {1058:0.02546686421447336}, {1062:0.025469453351191936}, {1059:0.09299179954834325}, {1063:0.1419676420175367}, {1055:0.12526981559182918}, {2437:0.03612240234192891}, {1056:0.03720865058084388}, {2438:0.1120234988629818}, {2439:0.0941602252679877}, {2440:0.1001512475614375}, {2441:0.10956844016738715}, {2442:0.09948137775063515}, {1060:0.0470698812795389}, {1064:0.06703569213680637}, {1061:0.14164847892618948}, {2443:0.04908439250929015}, {2444:0.13852394074201585}, {2445:0.19095041719265282}, {925:0.09108963671400007}, {1065:0.023077136537193985}, {2736:0.09392926696597076}, {2737:0.20228337137730884}, {2738:0.17495521026574176}, {2740:0.0383336465805769}, {2739:0.13579319368171341}, {2741:0.08976080172666998}, {2742:0.1635369423678831}, {2743:0.079748444724828}, {2744:0.11577632616866719}]
        var l = new FM.layer({
            "joindata": data,
            "colorramp": "YlGnBu",
            "classificationtype": "percentiles",
            "doublecounting": false,
            "decimalvalues": 5,
            "joincolumn": joincolumn,
            layers: 'fenix:gaul1_3857',
            layertitle: 'Join Dataset',
            layertype: 'JOIN',
            jointype: 'shaded',
            defaultgfi: true,
            openlegend: true,
            lang: "EN",
            opacity: '0.7',
            customgfi: {
                content: {
                    EN: "<div class='fm-popup'>{{"+ joincolumnlabel +"}}<div class='fm-popup-join-content'>{{{"+ joincolumn +"}}}</div></div>"
                },
                showpopup: true
            }
        });
        m2.addLayer(l);

        m2.addLayer( new FM.layer({
            layers: 'fenix:gaul0_line_3857',
            layertitle: 'Country Boundaries',
            urlWMS: 'http://fenixapps.fao.org/geoserver',
            opacity: '0.9',
            lang: 'en'
        }));



        // map3
        var m3 = new FM.Map('map3', {
            plugins: {
                geosearch: true,
                mouseposition: false,
                controlloading : true,
                disclaimerfao: true
            },
            guiController: {
                overlay: true,
                baselayer: true,
                wmsLoader: true
            },
            url: {
                MAP_SERVICE_SHADED: 'http://fenix.fao.org/test/geo/fenix/mapclassify/join/',
                DEFAULT_WMS_SERVER: 'http://fenix.fao.org/geoserver',
                MAP_SERVICE_GFI_JOIN: 'http://fenix.fao.org/test/geo/fenix/mapclassify/request/',
                MAP_SERVICE_GFI_STANDARD: 'http://fenix.fao.org/test/geo/fenix/mapclassify/request/'
            }
        });
        m3.createMap();
        m3.zoomTo("country", "iso3", ["THA"]);
        //
        //
        //var joincolumnlabel = 'adm2_name';
        //var joincolumn =  'adm2_code';
        //var mu =  '&#37;';
        var data = [{26968:0.29099451899528506}, {26993:0.2358226478099823}, {26604:0.01275138184428215}, {26962:0.29533369839191437}, {26945:0.5263658761978149}, {26469:0.18785587698221207}, {26531:0.05517714023590088}, {27053:0.1629580014074842}, {27146:0.08598519737521808}, {26584:0.2124267319838206}, {26738:0.24484863877296448}, {26453:0.31833820044994354}, {27038:0.09006849676370621}, {26882:0.41036443412303925}, {26532:0.052250634878873825}, {26682:0.49684590101242065}, {26874:0.7170052081346512}, {26454:0.420757457613945}, {26893:0.6195365190505981}, {26455:0.1809828206896782}, {26930:0.2254033237695694}, {26985:0.20505614578723907}, {27062:0.48088501890500385}, {26883:0.35009449124336245}, {26895:0.7509150207042694}, {26917:0.028478683903813362}, {26918:0.028393015265464783}, {26624:0.05819737131241709}, {26939:0.01880860406284531}, {27172:0.022038775529446348}, {26470:0.14492455621560416}, {26433:0.441110501686732}, {26867:0.23842289547125498}, {26700:0.24429073929786682}, {26756:0.07386890612542629}, {26434:0.3267345428466797}, {26643:0.36267024278640747}, {26969:0.38673000782728195}, {26678:0.3989739269018173}, {27072:0.024436114355921745}, {27181:0.023749052236477535}, {27073:0.017697804421186448}, {26689:0.2147462765375773}, {26990:0.09979597479104996}, {26585:0.3850937287012736}, {26725:0.5970428387324015}, {27147:0.06386228557676077}, {26929:0.3446943014860153}, {27164:0.2155953221264537}, {26825:0.27191001176834106}, {27103:0.03291052482090891}, {27074:0.008449240460653196}, {26471:0.2942337393760681}, {27182:0.018951124578182186}, {26757:0.020310331498169236}, {26572:0.071810449163119}, {26661:0.4803174063563347}, {27111:0.028399630760153134}, {26533:0.08401628211140633}, {27090:0.401514895260334}, {26701:0.2880250886082649}, {26787:0.14671552057067552}, {26788:0.15634708851575851}, {26789:0.13779664412140846}, {26406:0.023266369476914406}, {26855:0.18107718974351883}, {27126:0.24727378459647298}, {26868:0.21925992518663406}, {26611:0.03823410506759371}, {26644:0.24419409462383815}, {27075:0.020577957620844245}, {26494:0.0391050378481547}, {27148:0.4561130702495575}, {27076:0.023663650654877227}, {26702:0.23916231095790863}, {27039:0.11586261168122292}, {26770:0.04335799689094225}, {26383:0.31895830233891803}, {26970:0.41352570056915283}, {26884:0.10805359076369893}, {26472:0.16229507539953505}, {26947:0.5374358197053274}, {26739:0.11778249804462705}, {26740:0.11893024742603302}, {26495:0.009329533428951566}, {26848:0.12240319792181253}, {26631:0.10060637723654509}, {26516:0.1030085876584053}, {26758:0.06136210883657137}, {26849:0.04536750458646566}, {26517:0.09209984044233958}, {26662:0.4384327232837677}, {26741:0.11697006225585938}, {26771:0.028676144778728485}, {26703:0.31288227438926697}, {26931:0.1618904024362564}, {27091:0.49984726309776306}, {26496:0.06658476715286572}, {26856:0.2583051025867462}, {26586:0.21789416670799255}, {26587:0.2463842717309793}, {27092:0.5407048165798187}, {26704:0.2558460103140937}, {26726:0.4876270443201065}, {26850:0.11882580816745758}, {27063:0.3396629486232996}, {26705:0.25360163014668685}, {26573:0.04679518441359202}, {26632:0.04436823888681829}, {26906:0.054155209101736546}, {27127:0.5333814322948456}, {27064:0.6995352307955424}, {26497:0.04937445744872093}, {26498:0.042109154909849164}, {26851:0.38842110335826874}, {27065:0.7511536777019501}, {26672:0.1743553765118122}, {27128:0.7143785357475281}, {27077:0.022120446898043156}, {26671:0.31323058903217316}, {26683:0.48657894134521484}, {27173:0.03864054195582867}, {26499:0.07056139688938856}, {26612:0.05097740218043327}, {26500:0.10410748980939388}, {26463:0.8476243019104004}, {27040:0.08389851357787848}, {26501:0.033639179853101574}, {26919:0.014329919940792024}, {26549:0.3201677203178406}, {26550:0.23890843987464905}, {26706:0.26025675733884174}, {27117:0.07381910728290678}, {26742:0.08853397890925407}, {26384:0.3876338005065918}, {27033:0.9980285167694092}, {26826:0.1726337991654873}, {26484:0.03096162900328636}, {26998:0.15457201562821865}, {26473:0.17883017162481943}, {26869:0.03912846071438657}, {26707:0.23189890384674072}, {26551:0.38150548934936523}, {26684:0.4818461835384369}, {27078:0.026735258288681507}, {27118:0.08810636401176453}, {27016:0.2976418137550354}, {27017:0.40682701021432877}, {26664:0.4186214506626129}, {26727:0.5957968831062317}, {27093:0.3668708115816116}, {26924:0.005283690855971405}, {26832:0.008569320353368918}, {26474:0.11576851806603372}, {26948:0.5116689950227737}, {27079:0.024142490699887276}, {27187:0.362045019865036}, {26552:0.22654588023821512}, {26708:0.2684306502342224}, {26971:0.41108284890651703}, {26743:0.092513807117939}, {26563:0.40031776428222654}, {26840:0.10814334824681282}, {26940:0.015690734920402367}, {26857:0.07292244862765074}, {26485:0.015626660268753766}, {26605:0.017495799499253433}, {27112:0.04314749035984278}, {26588:0.3057432547211647}, {26553:0.3029716908931732}, {26870:0.30809758603572845}, {27129:0.23862185080846152}, {27054:0.292026050388813}, {27080:0.021304269414395095}, {26963:0.3260343670845032}, {26564:0.40056598782539365}, {26565:0.12977677781600505}, {26806:0.41827258467674255}, {26606:0.03046615927347115}, {26486:0.012737088021822274}, {26645:0.21799573302268982}, {26814:0.18358471989631653}, {26646:0.3369121253490448}, {26972:0.19476401805877686}, {26710:0.18206674910404466}, {26711:0.25932073295116426}, {27130:0.1268456369638443}, {26475:0.07580451543132465}, {26476:0.235792338848114}, {27188:0.5111287832260132}, {27008:0.03789324685931206}, {27131:0.43010974675416946}, {27009:0.08602171465754509}, {26841:0.18002087250351906}, {27041:0.06823418289422989}, {27018:0.4286192536354065}, {26673:0.2675473466515541}, {26436:0.4246352016925812}, {27019:0.2784837856888771}, {26518:0.15687312185764313}, {26654:0.011198914652182297}, {26833:0.004004879291945447}, {26941:0.01576339267194271}, {26613:0.1013456614067157}, {26607:0.014190739952027798}, {27055:0.32914604619145393}, {26842:0.34453727304935455}, {27082:0.04176409915089607}, {26665:0.4599650576710701}, {26834:0.007128315977752209}, {26925:0.059259355440735816}, {26589:0.29724955062071484}, {27042:0.04046028479933739}, {26437:0.4421116039156914}, {26991:0.1605696827173233}, {26728:0.22361834347248077}, {26554:0.3273538649082184}, {26920:0.018571264576166868}, {27149:0.10285184106656484}, {26973:0.17725458244482675}, {26974:0.18569729384034872}, {27150:0.10169294476509094}, {27189:0.4015689492225647}, {27115:0.00669368061547478}, {26438:0.35862045797208947}, {26541:0.03188434739907583}, {27094:0.5540237724781036}, {26807:0.8295213580131531}, {26439:0.40425287187099457}, {26647:0.17007145285606384}, {26608:0.17641555269559225}, {26542:0.03173460178077221}, {27010:0.03742324747145176}, {26566:0.33473092317581177}, {27166:0.32260180190205573}, {26745:0.11519164592027664}, {26574:0.2359633967280388}, {27174:0.2594505250453949}, {26729:0.5347457379102707}, {26926:0.00486516096862033}, {26626:0.034227496227965906}, {27190:0.3913206841264452}, {26858:0.1419483780860901}, {26859:0.1404998360408677}, {26907:0.012641925568459556}, {26385:0.44622355699539185}, {26502:0.07280913889408111}, {26503:0.013345493331805548}, {26852:0.35191382467746735}, {26519:0.2386897752682368}, {26759:0.03037994522601366}, {26520:0.11680688088138898}, {26815:0.18533821403980255}, {26655:0.010002704544199837}, {26614:0.035269902708629765}, {26615:0.04331453461199999}, {27104:0.024155121482908725}, {26504:0.027872776612639427}, {26521:0.1167377345263958}, {26656:0.007284732087282464}, {27105:0.03239094994829169}, {26522:0.08741582650691271}, {26505:0.028593674302101135}, {26616:0.08795355632901192}, {26627:0.006290335499215871}, {26506:0.020015792300303776}, {26730:0.34110137533683044}, {27191:0.436444416642189}, {26488:0.014409095514565706}, {26590:0.2528097952405612}, {26464:0.936598002910614}, {26817:0.1770983636379242}, {26999:0.2696043401956558}, {26386:0.42659249901771545}, {26440:0.42357039120462203}, {26457:0.2958863377571106}, {26465:0.800528883934021}, {26477:0.15997259505093098}, {26507:0.07063725590705872}, {26523:0.19658869815369448}, {26543:0.026541676217069227}, {26555:0.27107296884059906}, {26567:0.3040209333101908}, {26575:0.0443283294637998}, {26591:0.2859526979071753}, {26609:0.010148036759346724}, {26617:0.08014710173010826}, {26628:0.14360391721129417}, {26633:0.0651605561375618}, {26648:0.27216506376862526}, {26657:0.015564606681436999}, {26666:0.4085089365641276}, {26674:0.29800471290946007}, {26731:0.3687479794025421}, {26679:0.32417099071400507}, {26685:0.20160187780857086}, {26690:0.1272355705499649}, {26712:0.22099935511747995}, {26746:0.07045978556076686}, {26760:0.10142861425199291}, {26772:0.032390531773368515}, {26782:0.08267329840196504}, {26790:0.2620730016912733}, {26618:0.044549434818327426}, {26835:0.009531001405169567}, {26843:0.24700268109639487}, {26853:0.21125750492016473}, {26860:0.11520652978547982}, {26875:0.5897753834724426}, {26885:0.3726341823736827}, {26908:0.17939898868401846}, {26915:0.01462414301931858}, {26827:0.33830990493297575}, {26921:0.03314333657423655}, {26927:0.00392826262395829}, {26933:0.21034309267997742}, {26942:0.014176578260958195}, {26950:0.6240096688270569}, {26964:0.20042488103111586}, {26975:0.1829939070675108}, {27133:0.39262768626213074}, {26986:0.28344401717185974}, {26992:0.07446379959583282}, {27011:0.013725415617227555}, {27021:0.507208801805973}, {27056:0.2773497700691223}, {27066:0.6601192355155945}, {27083:0.026383206869165104}, {27095:0.5165140827496847}, {27106:0.05690526172984391}, {27119:0.06385873444378376}, {27116:0.029986325385315076}, {27134:0.42489540576934814}, {27151:0.09655843721702695}, {27167:0.7639480233192444}, {27175:0.24562201499938965}, {27183:0.0345626026391983}, {27192:0.390201735496521}, {27135:0.36078914006551105}, {26667:0.4974302053451538}, {26828:0.15070230407374247}, {26634:0.09141146093606949}, {26668:0.4504452347755432}, {26635:0.03716037459671497}, {26691:0.190244326988856}, {26686:0.43987777829170227}, {26886:0.1626089287456125}, {26783:0.07901690279444058}, {27022:0.4972851574420929}, {26861:0.06308371503837407}, {26556:0.32096511125564575}, {27176:0.048366078501567246}, {26592:0.2972429431974888}, {27153:0.045288565258185066}, {26761:0.04062622731241087}, {27137:0.30566176109843785}, {26442:0.3807756185531616}, {26762:0.03328705387603906}, {27045:0.10309607349336147}, {26692:0.23008142411708832}, {26693:0.11485254392027855}, {26490:0.02056934405118227}, {27136:0.558763325214386}, {27120:0.006154696457087994}, {27152:0.03489948157221079}, {26619:0.08667359198443592}, {26976:0.27717551589012146}, {26675:0.4650697708129883}, {26887:0.2504836196700732}, {26478:0.21339963376522064}, {26443:0.2995590642094612}, {26732:0.33117469400167465}, {26479:0.08686282645378794}, {26480:0.11761230044066906}, {26716:0.29082585871219635}, {27168:0.9520935118198395}, {27156:0.0876733347773552}, {26445:0.48672881722450256}, {27002:0.36062389612197876}, {27169:1.0429956912994385}, {26446:0.4046427235007286}, {26557:0.3417975977063179}, {26649:0.3604765037695567}, {26862:0.14094587974250317}, {26952:0.4401165743668874}, {26576:0.2048906870186329}, {26593:0.3573742111523946}, {26594:0.32669585198163986}, {26810:0.6036204695701599}, {26676:0.24689674377441406}, {26872:0.058887116611003876}, {27067:0.6839753091335297}, {27023:0.5044518411159515}, {27154:0.303913451731205}, {27155:0.0334630124270916}, {26784:0.07956182360649108}, {26714:0.27308061718940735}, {26715:0.23641310334205629}, {26508:0.01443882978300711}, {26680:0.07552894204854965}, {26844:0.13932332769036293}, {26524:0.13515904545783997}, {26658:0.008743256553048816}, {26636:0.08220834136009217}, {26717:0.17175351402589253}, {26447:0.46954818069934845}, {26791:0.10560023412108421}, {26748:0.07827283690373103}, {26845:0.04013807326555252}, {26681:0.5638557076454163}, {26934:0.20157833769917488}, {26718:0.24262099713087082}, {27121:0.017347742803394794}, {26659:0.013732069171965122}, {26568:0.14568167924880981}, {26629:0.1663956716656685}, {26544:0.042624755203723906}, {26953:0.5441061854362488}, {26387:0.5623151361942291}, {27193:0.34786179661750793}, {26733:0.44699173739978243}, {26481:0.08262445156772931}, {26637:0.11948100104928017}, {26525:0.2659655809402466}, {26538:0.12523097395896912}, {26977:0.29022441804409027}, {26978:0.26679586867491406}, {27084:0.010247069003526121}, {26954:0.5010891854763031}, {26458:0.40558648109436035}, {26577:0.14702645026975208}, {26545:0.018392083467915654}, {26650:0.28301214054226875}, {26669:0.4656183024247487}, {26526:0.179312352091074}, {27158:0.11449223244562745}, {27138:0.403517742951711}, {27159:0.10207781195640564}, {27177:0.310705045859019}, {26719:0.29078366855780285}, {26749:0.0747477188706398}, {26955:0.47599587837855023}, {26595:0.3426389694213867}, {26792:0.2638896902402242}, {26979:0.15356456488370895}, {26793:0.23377944342792034}, {26694:0.2155601680278778}, {26957:0.3740373452504476}, {27107:0.03040066427950348}, {26876:0.7523905038833618}, {27139:0.2257072627544403}, {26877:0.7811565846204758}, {26935:0.21720806881785393}, {26569:0.18936089922984442}, {26509:0.01769285777118057}, {27004:0.23446793854236603}, {27085:0.01867893747985363}, {26596:0.1457531899213791}, {26888:0.421364963054657}, {26448:0.4666741192340851}, {26482:0.17506998280684152}, {26638:0.07913620929632868}, {26639:0.09645473770797253}, {27086:0.02603200972080231}, {26597:0.16416959464550018}, {26640:0.04141690656542778}, {27025:0.21625331416726112}, {26449:0.4472966194152832}, {26598:0.2182049857718604}, {26734:0.37161999344825747}, {26459:0.24659796059131622}, {26610:0.01274782419204712}, {26695:0.1116755207379659}, {26943:0.019714974487821262}, {26854:0.08116718364710157}, {26491:0.011052603833377361}, {26829:0.12827528733760118}, {26450:0.45637059956789017}, {26922:0.01620611298130825}, {27026:0.4868968427181244}, {27096:0.5189022533595562}, {26720:0.28084249794483185}, {26425:0.016141965985298157}, {26763:0.06012022743622462}, {27184:0.029469307977706194}, {26773:0.038000342746575676}, {27046:0.07616542093455791}, {27027:0.4233201841513316}, {27122:0.024733930826187134}, {27097:0.4885571375489235}, {27047:0.1047431044280529}, {26910:0.09687664572681699}, {26751:0.16089578717947006}, {26774:0.03218607511371374}, {27048:0.08041905363400777}, {26651:0.22731243073940277}, {27049:0.07998326553830079}, {26559:0.2982478737831116}, {27194:0.33456818759441376}, {26570:0.383651040494442}, {26578:0.017844706100573683}, {27068:0.7633766233921051}, {26878:0.6096014142036438}, {27108:0.01610802316443167}, {26510:0.01966190878301859}, {27140:0.7170006334781647}, {27098:0.5318003743886948}, {26989:0.05678926408290863}, {26461:0.40018948167562485}, {27099:0.4712640233337879}, {26579:0.016592268451032312}, {26794:0.13287784593800703}, {27160:0.07904164493083954}, {26511:0.09024385176599026}, {26466:0.9808154106140137}, {26513:0.06795590661931783}, {26467:0.9463745951652527}, {26451:0.46730899810791016}, {26395:0.8868785500526428}, {27170:0.5920581420262655}, {26980:0.3346979575497763}, {27057:0.3069992810487747}, {26546:0.027530689956620336}, {26795:0.2572024737795194}, {26958:0.46127697825431824}, {26846:0.4885181188583374}, {26785:0.07367679583174842}, {26796:0.21520966291427612}, {26600:0.12255811728537083}, {26752:0.09099107421934605}, {27123:0.026005262043327093}, {26721:0.25551794634924996}, {27101:0.5944535136222839}, {26830:0.14936819672584534}, {26831:0.25943106412887573}, {27141:0.3627760708332062}, {27051:0.07011428102850914}, {27069:0.8223676681518555}, {26540:0.03345383579532305}, {27142:0.19924284294247627}, {26775:0.03392232209444046}, {27059:0.27374661564826963}, {27060:0.14757251356624895}, {26580:0.021338448885621294}, {26959:0.546982616186142}, {27161:0.11739608645439148}, {26863:0.19327369332313538}, {26797:0.27331916242837906}, {26620:0.03441040581092238}, {26722:0.1909035723656416}, {26492:0.11431880867374795}, {26560:0.2728893365710974}, {26911:0.03858133214331853}, {26981:0.29707033932209015}, {26765:0.13196875403324762}, {27070:0.5159376412630081}, {26798:0.23097875341773033}, {26660:0.01718932291906741}, {26621:0.11580120508248608}, {26697:0.2012356072664261}, {26936:0.09093771657596032}, {26776:0.04433457056681315}, {26928:0.010425537824630737}, {26778:0.031351618468761444}, {26912:0.13351279310882092}, {26723:0.2568210452795029}, {26786:0.09771788616975148}, {26960:0.46740541607141495}, {26779:0.043921228498220444}, {26735:0.5213768407702446}, {26736:0.4530871093273163}, {26836:0.00593718895688653}, {26837:0.010625510942190886}, {26847:0.3233979418873787}, {27143:0.37502169609069824}, {26982:0.10773118585348129}, {26880:0.7480235695838928}, {26965:0.21568221350510916}, {26879:0.6736429929733276}, {26799:0.24390575289726257}, {27087:0.03155763000249863}, {27088:0.01879597579439481}, {27195:0.3870336711406708}, {26838:0.009552148170769215}, {26916:0.017936456948518753}, {26641:0.027467055479064584}, {26652:0.3002938777208328}, {26493:0.0246717631816864}, {26581:0.09868817403912544}, {26582:0.06026851758360863}, {27185:0.02197921520564705}, {27012:0.029404405504465103}, {27178:0.05523772618140687}, {26839:0.007676105946302414}, {26923:0.030279316008090973}, {27171:1.0129817128181458}, {26547:0.030952416732907294}, {26753:0.0676977675408125}, {27109:0.02587511103289823}, {26462:0.29849999537691474}, {26737:0.4872367935521262}, {26699:0.22965119779109955}, {27102:0.5171474814414978}, {26698:0.10275811981409788}, {26766:0.09552725031971931}, {26961:0.5258880356947581}, {26653:0.32667502760887146}, {26873:0.17015389427542688}, {27052:0.09950471296906471}, {26483:0.12353893518447875}, {26622:0.025401109152219513}, {26527:0.14535925643784658}, {26583:0.013123412302229553}, {27179:0.14139071386307478}, {26767:0.04048867772022883}, {27162:0.27514514327049255}, {26630:0.007585475221276283}, {26571:0.41886313259601593}, {27061:0.09237627126276493}, {26754:0.1891225352883339}, {26548:0.03676154091954231}, {27013:0.09761722137530644}, {26755:0.08878711331635714}, {27144:0.40092078277042936}, {26601:0.34705445170402527}, {27110:0.021230575664398763}, {27071:0.37221292157967883}, {27029:0.46251288056373596}, {26780:0.06651939451694489}, {26602:0.32561567425727844}, {26944:0.02042238476375739}, {26913:0.049440743091205754}, {27030:0.3864095211029053}, {27006:0.3476453274488449}, {26724:0.18585754558444023}, {26966:0.25222807824611665}, {26905:0.6727241277694702}, {26623:0.07942556190703597}, {26864:0.2641709465533495}, {26881:0.6389906803766886}, {27163:0.08211668208241463}, {26642:0.10188264813688067}, {26889:0.29382164229949315}, {27124:0.0241253562271595}, {26983:0.3281857594847679}, {26670:0.5381767849127451}, {27145:0.36065031339724857}, {26984:0.3760187029838562}, {26890:0.23126092659575598}, {26468:0.8410820215940475}, {26967:0.16734761968255044}, {26528:0.19664085656404495}, {26515:0.01425819587893784}, {26529:0.09036780148744583}, {26530:0.05926066585299042}, {26768:0.04244603778546055}, {27089:0.026727598160505295}, {26865:0.1921533688902855}, {27007:0.3448832035064697}, {26396:1.0161843299865723}, {27186:0.04268199045743261}, {27031:0.5045315027236938}, {26562:0.29087214668591815}, {27125:0.01728138979524374}]
        var l = new FM.layer({
            joindata: data,
            "colorramp": "RdPu",
            "classification_type": "Jenks_Caspall_Forced",
            "double_counting": false,
            "decimalvalues": 5,
            "joincolumn": "adm2_code",
            layers: 'fenix:gaul2_3857',
            layertitle: 'Join Dataset',
            layertype: 'JOIN',
            jointype: 'shaded',
            defaultgfi: true,
            openlegend: true,
            lang: "EN",
            opacity: '0.7',
            customgfi: {
                content: {
                    EN: "<div class='fm-popup'>{{adm2_name}}<div class='fm-popup-join-content'>{{{adm2_code}}}</div></div>"
                },
                showpopup: true
            }
        });
        m3.addLayer(l);

        m3.addLayer( new FM.layer({
            layers: 'fenix:gaul0_line_3857',
            layertitle: 'Country Boundaries',
            urlWMS: 'http://fenixapps.fao.org/geoserver',
            opacity: '0.9',
            lang: 'en'
        }));
    });

});






